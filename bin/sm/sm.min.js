var sm;!function(t){t.version="1.0.3"}(sm||(sm={}));var sm;!function(t){var e=function(){function t(){}return t.e1="重复添加状态",t.e2="重复添加事件",t.e3="不可执行事件",t.e4="转向状态to不可以为none",t.e5="注册状态或事件不能为null",t.e6="注册状态必须有stateName或事件必须有eventName属性",t.e7="必须是函数",t.e8="当前已阻塞，等待调用transition或cancelTransition",t}();t.ErrorCode=e}(sm||(sm={}));var sm;!function(t){var e=function(){function e(){this.froms=[]}return e.register=function(e,n,r){var i=new t.StateEventUnit;return i.register(e,n,r),i},e.prototype.addFroms=function(t){t&&0!=t.length&&t.forEach(function(t){this.addFrom(t)},this)},e.prototype.addFrom=function(t){t&&(t instanceof Array?this.addFroms(t):!this.findFromByName(t)&&this.froms.push(t))},e.prototype.findFromByName=function(t){var e=this.froms.indexOf(t);return!!~e},e.prototype.register=function(t,e,n){this.event=t,this.addFrom(e),this.to=n},e}();t.StateEventUnit=e}(sm||(sm={}));var sm;!function(t){var e=function(){function t(){this._stateEventUnit=[],this._states={},this._events={}}return t.prototype.pushUnit=function(t){var e=this.findStateEventUnitByToName(t.event,t.to);!e&&this._stateEventUnit.push(t)},t.prototype.pushState=function(t){var e=this.findStateByName(t.stateName);!e&&(this._states[t.stateName]=t)},t.prototype.pushEvent=function(t){var e=this.findEventByName(t.eventName);!e&&(this._events[t.eventName]=t)},t.prototype.findStateEventUnitByToName=function(t,e){for(var n=this._stateEventUnit.length,r=0;r<n;r++){var i=this._stateEventUnit[r];if(i.event==t&&i.to==e)return i}return null},t.prototype.findStateEventUnitByFromName=function(t,e){for(var n=this._stateEventUnit.length,r=0;r<n;r++){var i=this._stateEventUnit[r];if(i.event==t&&(this.isNoneEvent(i,e)||i.findFromByName(e)))return i}return null},t.prototype.isNoneEvent=function(t,e){return"none"==e||t.findFromByName("none")},t.prototype.findStateByName=function(t){var e=this._states[t];return e||null},t.prototype.findEventByName=function(t){var e=this._events[t];return e||null},t}();t.StateMachineData=e}(sm||(sm={}));var sm;!function(t){var e=function(){function e(){this.DEFAULT="none",this.ASYNC="async",this.initial=this.DEFAULT,this._data=new t.StateMachineData}return e.create=function(){return new t.StateMachine},Object.defineProperty(e.prototype,"current",{get:function(){return this._current||this.initial},enumerable:!0,configurable:!0}),e.prototype.register=function(e,n,r){if(r==this.DEFAULT)throw t.ErrorCode.e4;var i=this._data.findStateEventUnitByToName(e,r);i?i.addFrom(n):(i=t.StateEventUnit.register(e,n,r),this._data.pushUnit(i))},e.prototype.registerStates=function(t){if(t){if(t instanceof Array)for(var e=t.length,n=0;n<e;n++)this.registerState(t[n]);else this.registerState(t);return this}},e.prototype.registerState=function(e){if(!e)throw t.ErrorCode.e5;if(!e.stateName)throw t.ErrorCode.e6;if(e.onEnter&&"function"!=typeof e.onEnter)throw"onAfter"+t.ErrorCode.e7;if(e.onLeave&&"function"!=typeof e.onLeave)throw"onLeave"+t.ErrorCode.e7;if(e.onInterrupt&&"function"!=typeof e.onInterrupt)throw"onInterrupt"+t.ErrorCode.e7;var n=this._data.findStateByName(e.stateName);if(n)throw t.ErrorCode.e1+e.stateName;this._data.pushState(e)},e.prototype.registerEvents=function(t){if(t){if(t instanceof Array)for(var e=t.length,n=0;n<e;n++)this.registerEvent(t[n]);else this.registerEvent(t);return this}},e.prototype.registerEvent=function(e){if(!e)throw t.ErrorCode.e5;if(!e.eventName)throw t.ErrorCode.e6;if(e.onAfter&&"function"!=typeof e.onAfter)throw"onAfter"+t.ErrorCode.e7;if(e.onBefore&&"function"!=typeof e.onBefore)throw"onBefore"+t.ErrorCode.e7;var n=this._data.findEventByName(e.eventName);if(n)throw t.ErrorCode.e2+e.eventName;return this._data.pushEvent(e),this},e.prototype.emit=function(e){if(this.transitionUnit)return void console.log(this.current,t.ErrorCode.e8,t.ErrorCode.e3,e);var n=this._data.findStateEventUnitByFromName(e,this.current);n&&this.execute(n),!n&&console.log(t.ErrorCode.e3,e)},e.prototype.can=function(t){if(this.transitionUnit)return!1;var e=this._data.findStateEventUnitByFromName(t,this.current);return!!e},e.prototype.is=function(t){return t==this.current},e.prototype.transition=function(){this.transitionUnit&&(this.interrupter(this.current),this.enter(this.transitionUnit.to),this.after(this.transitionUnit.event),this._current=this.transitionUnit.to),this.transitionUnit=null},e.prototype.cancelTransition=function(){this.transitionUnit&&(this.interrupter(this.current),this.after(this.transitionUnit.event)),this.transitionUnit=null},e.prototype.isTransition=function(){return!!this.transitionUnit},e.prototype.interrupt=function(){this.cancelTransition(),this._current=this.DEFAULT},e.prototype.execute=function(t){var e=this._data.findStateByName(this.current);this.before(t.event);var n=!0;e&&e.onLeave&&(n=e.onLeave()),n==this.ASYNC?this.transitionUnit=t:(this.enter(t.to),this.after(t.event),this._current=t.to)},e.prototype.interrupter=function(t){var e=this._data.findStateByName(t);e&&e.onInterrupt&&e.onInterrupt()},e.prototype.enter=function(t){var e=this._data.findStateByName(t);e&&e.onEnter&&e.onEnter()},e.prototype.after=function(t){var e=this._data.findEventByName(t);e&&e.onAfter&&e.onAfter()},e.prototype.before=function(t){var e=this._data.findEventByName(t);e&&e.onBefore&&e.onBefore()},e}();t.StateMachine=e}(sm||(sm={}));